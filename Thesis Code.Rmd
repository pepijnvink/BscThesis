---
title: "Thesis Practice"
author: "Pepijn Vink"
date: "3/6/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load packages

```{r load-libraries, message = FALSE}
library(BayesFactor)
library(tidyverse)
library(magrittr)
library(jtools)
library(bayestestR)
library(gmodels)
library(BRRR)
library(skimr)
library(tidybayes)
library(patchwork)
library(pwr)
```

Load function to make simulation more smooth. BF 'cutoffs' and evidence levels are based on Jeffrey's (1961). For p values, CI's and HDI's, 1 indicates rejection of the null and 0 no rejection. For the BF's at every cutoff value, 0 indicates preference for the null, 1 indicates no preference, and 2 indicates preference for the alternative/complement. Posterior probabilities are based on equal prior odds.

```{r load-function}
source("freq.bayes.R")
```


# Simulate different sample sizes

## Power analysis to determine samle size for power of 50% and 80%

```{r power-analysis}
pwr.t.test(d = 0.5, power = 0.5, type = "two.sample", alternative = "two.sided")
pwr.t.test(d = 0.5, power = 0.8, type = "two.sample", alternative = "two.sided")
```

## No effect

```{r simulate-null, message = FALSE}
set.seed(42)

# n = 10
df0.n10 <- as.data.frame(freq.bayes(sample.size = 10, iterations = 10000))

# n = 32
df0.n32 <- as.data.frame(freq.bayes(sample.size = 32, iterations = 10000))

# n = 64
df0.n64 <- as.data.frame(freq.bayes(sample.size = 64, iterations = 10000))

# n = 100
df0.n100 <- as.data.frame(freq.bayes(sample.size = 100, iterations = 10000))

# n = 300
df0.n300 <- as.data.frame(freq.bayes(sample.size = 300, iterations = 10000))

# n = 500
df0.n500 <- as.data.frame(freq.bayes(sample.size = 500, iterations = 10000))
```


## Medium effect (delta = 0.5, difference = 5)

```{r simulate-effect, message = FALSE}
set.seed(69)

# n = 10
df.n10 <- as.data.frame(freq.bayes(sample.size = 10, iterations = 10000, difference = 5))

# n = 32
df.n32 <- as.data.frame(freq.bayes(sample.size = 32, iterations = 10000, difference = 5))

# n = 64
df.n64 <- as.data.frame(freq.bayes(sample.size = 64, iterations = 10000, difference = 5))

# n = 100
df.n100 <- as.data.frame(freq.bayes(sample.size = 100, iterations = 10000, difference = 5))

# n = 300
df.n300 <- as.data.frame(freq.bayes(sample.size = 300, iterations = 10000, difference = 5))

# n = 500
df.n500 <- as.data.frame(freq.bayes(sample.size = 500, iterations = 10000, difference = 5))
```


## Combine results for null

```{r}
df0 <- rbind(df0.n10, df0.n32, df0.n64, df0.n100, df0.n300, df0.n500)

# Convert relevant columns to numeric
df0[c(1:15, 28, 29, 33, 34)] <- sapply(df0[c(1:15, 28, 29, 33, 34)], as.numeric)

## Convert BF.evidence, n, and difference to factor
df0$BF.evidence <- as.factor(df0$BF.evidence)
df0$n_num <- df0$n
df0$n <- as.factor(df0$n) %>% fct_relevel(c("10", "32", "64", "300", "100", "500"))
df0$BF3.decision <- as_factor(df0$BF3.decision) %>% fct_relevel(c("null", "U", "alt"))
df0$BF10.decision <- as_factor(df0$BF10.decision) %>% fct_relevel(c("null", "U", "alt"))
df0$BF30.decision <- as_factor(df0$BF30.decision) %>% fct_relevel(c("null", "U", "alt"))
df0$p.decision <- as_factor(df0$p.decision) %>% fct_relevel(c("null", "alt"))
df0$p.correct <- as.factor(case_when(df0$p <= .05 & df0$difference > 0 & df0$diff_obs  > 0 ~ "correct",
                          df0$p <= .05 & df0$difference < 0 & df0$diff_obs  < 0 ~ "correct",
                          df0$p > .05 & df0$difference == 0 ~ "correct",
                          TRUE ~ "incorrect"))
df0$HDI.correct <- as.factor(case_when(df0$HDI.decision == "null" & df0$difference == 0 ~ "correct",
                                       df0$HDI.decision == "alt" & df0$difference > 0 & df0$diff_obs > 0 ~ "correct",
                                       df0$HDI.decision == "alt" & df0$difference < 0 & df0$diff_obs < 0 ~ "correct",
                                       TRUE ~ "incorrect"))
df0$BF1.correct <- as.factor(case_when(df0$BF1.decision == "null" & df0$difference == 0 ~ "correct",
                                       df0$BF1.decision == "alt" & df0$difference > 0 & df0$diff_obs > 0 ~ "correct",
                                       df0$BF1.decision == "alt" & df0$difference < 0 & df0$diff_obs < 0 ~ "correct",
                                       TRUE ~ "incorrect"))
df0$difference <- as.factor(df0$difference) 
df0$BF.3.cor <- as_factor(df0$BF.3.cor) %>% fct_relevel(c("incorrect", "correct"))
df0$BF.10.cor <- as_factor(df0$BF.10.cor) %>% fct_relevel(c("incorrect", "correct"))
df0$BF.30.cor <- as_factor(df0$BF.30.cor) %>% fct_relevel(c("incorrect", "correct"))
df0$BF.3.ninc <- as_factor(df0$BF.3.ninc) %>% fct_relevel(c("incorrect", "correct"))
df0$BF.10.ninc <- as_factor(df0$BF.10.ninc) %>% fct_relevel(c("incorrect", "correct"))
df0$BF.30.ninc <- as_factor(df0$BF.30.ninc) %>% fct_relevel(c("incorrect", "correct"))
df0$BF1.decision <- as_factor(df0$BF1.decision) %>% fct_relevel(c("null", "alt"))
df0$HDI.decision <- as_factor(df0$HDI.decision)  %>% fct_relevel(c("null", "alt"))
df0$HDI.est.correct <- as_factor(df0$HDI.est.correct) %>% fct_relevel(c("incorrect", "correct"))
df0$CI.est.correct <- as_factor(df0$CI.est.correct) %>% fct_relevel(c("incorrect", "correct"))
```

## Combine results for delta = .5

```{r}
df <- rbind(df.n10, df.n32, df.n64, df.n100, df.n300, df.n500)

# Convert relevant columns to numeric
df[c(1:15, 28, 29, 33, 34)] <- sapply(df[c(1:15, 28, 29, 33, 34)], as.numeric)

## Convert BF.evidence, n, and difference to factor
df$BF.evidence <- as.factor(df$BF.evidence)
df$n_num <- df$n
df$n <- as.factor(df$n) %>% fct_relevel(c("10", "32", "64", "300", "100", "500"))
df$BF3.decision <- as.factor(df$BF3.decision) %>% fct_relevel(c("null", "U", "alt"))
df$BF10.decision <- as.factor(df$BF10.decision) %>% fct_relevel(c("null", "U", "alt"))
df$BF30.decision <- as.factor(df$BF30.decision) %>% fct_relevel(c("null", "U", "alt"))
df$p.decision <- as.factor(df$p.decision) %>% fct_relevel(c("null", "alt"))
df$p.correct <- as.factor(case_when(df$p <= .05 & df$difference > 0 & df$diff_obs  > 0 ~ "correct",
                          df$p <= .05 & df$difference < 0 & df$diff_obs  < 0 ~ "correct",
                          df$p > .05 & df$difference == 0 ~ "correct",
                          TRUE ~ "incorrect"))
df$HDI.correct <- as.factor(case_when(df$HDI.decision == "null" & df$difference == 0 ~ "correct",
                                       df$HDI.decision == "alt" & df$difference > 0 & df$diff_obs > 0 ~ "correct",
                                       df$HDI.decision == "alt" & df$difference < 0 & df$diff_obs < 0 ~ "correct",
                                       TRUE ~ "incorrect"))
df$BF1.correct <- as.factor(case_when(df$BF1.decision == "null" & df$difference == 0 ~ "correct",
                                       df$BF1.decision == "alt" & df$difference > 0 & df$diff_obs > 0 ~ "correct",
                                       df$BF1.decision == "alt" & df$difference < 0 & df$diff_obs < 0 ~ "correct",
                                       TRUE ~ "incorrect"))
df$difference <- as.factor(df$difference)
df$BF.3.cor <- as_factor(df$BF.3.cor) %>% fct_relevel(c("incorrect", "correct"))
df$BF.10.cor <- as_factor(df$BF.10.cor) %>% fct_relevel(c("incorrect", "correct"))
df$BF.30.cor <- as_factor(df$BF.30.cor) %>% fct_relevel(c("incorrect", "correct"))
df$BF.3.ninc <- as_factor(df$BF.3.ninc) %>% fct_relevel(c("incorrect", "correct"))
df$BF.10.ninc <- as_factor(df$BF.10.ninc) %>% fct_relevel(c("incorrect", "correct"))
df$BF.30.ninc <- as_factor(df$BF.30.ninc) %>% fct_relevel(c("incorrect", "correct"))
df$BF1.decision <- as_factor(df$BF1.decision) %>% fct_relevel(c("null", "alt"))
df$HDI.decision <- as.factor(df$HDI.decision)  %>% fct_relevel(c("null", "alt"))
df$HDI.est.correct <- as.factor(df$HDI.est.correct) %>% fct_relevel(c("incorrect", "correct"))
df$CI.est.correct <- as.factor(df$CI.est.correct) %>% fct_relevel(c("incorrect", "correct"))
```

# Visualizations

## Visualize p-value distributions

```{r}
(p.dis.n10 <- ggplot(df[df$n == 10,], aes(p)) + geom_histogram(bins = 100) + theme_apa() + scale_fill_grey())
(p.dis.n32 <- ggplot(df[df$n == 32,], aes(p)) + geom_histogram(bins = 100) + theme_apa() + scale_fill_grey())
(p.dis.n64 <- ggplot(df[df$n == 64,], aes(p)) + geom_histogram(bins = 100) + theme_apa() + scale_fill_grey())
(p.dis.n100 <- ggplot(df[df$n == 100,], aes(p)) + geom_histogram(bins = 100) + theme_apa() + scale_fill_grey())
(p.dis.n500 <- ggplot(df[df$n == 500,], aes(p)) + geom_histogram(bins = 100) + theme_apa() + scale_fill_grey())

(p.distributions <-
  p.dis.n10/
  p.dis.n32/
  p.dis.n64/
  p.dis.n100/
  p.dis.n500)
```

## Visualize p correct and BF correct for null

```{r}
p.correct.percentage.0 <- df0 %>%
  group_by(n_num, p.correct, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

BF1.correct.percentage.0 <- df0 %>%
  group_by(n_num, BF1.correct, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

HDI.correct.percentage.0 <- df0 %>%
  group_by(n_num, HDI.correct, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

BF3.correct.percentage.0 <- df0 %>%
  group_by(n_num, BF.3.cor, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)
  

BF10.correct.percentage.0 <- df0 %>%
  group_by(n_num, BF.10.cor, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

correct.rows.BF30.cor0 <- data.frame(c(10, 32, 64, 100, 300, 500),
        c("correct", "correct", "correct", "correct", "correct", "correct"),
        c(0, 0, 0, 0, 0, 0 ),
        c(0, 0, 0, 0, 0, 0),
        c(0, 0, 0, 0, 0, 0))

names(correct.rows.BF30.cor0) <- c("n_num", "BF.30.cor", "N", "freq", "pct")

BF30.correct.percentage.0 <- df0 %>%
  group_by(n_num, BF.30.cor, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100) %>%
  as.data.frame() %>%
  plyr::rbind.fill(correct.rows.BF30.cor0)
BF30.correct.percentage.0$BF.30.cor <- as_factor(BF30.correct.percentage.0$BF.30.cor)

ggplot(NULL, aes(x = n_num, y = pct)) + 
  ylim(0, 100) +
  geom_point(data = p.correct.percentage.0[p.correct.percentage.0$p.correct == "correct" & p.correct.percentage.0$n_num < 2000, ], aes(color = "p < .05")) + 
  geom_line(data = p.correct.percentage.0[p.correct.percentage.0$p.correct == "correct" & p.correct.percentage.0$n_num < 2000, ], aes(color = "p < .05")) + 
  geom_point(data = HDI.correct.percentage.0[HDI.correct.percentage.0$HDI.correct == "correct" & HDI.correct.percentage.0$n_num < 2000, ], aes(color = "HDI")) +
  geom_line(data = HDI.correct.percentage.0[HDI.correct.percentage.0$HDI.correct == "correct" & HDI.correct.percentage.0$n_num < 2000, ], aes(color = "HDI")) +
  geom_point(data = BF1.correct.percentage.0[BF1.correct.percentage.0$BF1.correct == "correct" & BF1.correct.percentage.0$n_num < 2000, ], aes(color = "BF > 1")) + 
  geom_line(data = BF1.correct.percentage.0[BF1.correct.percentage.0$BF1.correct == "correct" & BF1.correct.percentage.0$n_num < 2000, ], aes(color = "BF > 1")) + 
  geom_point(data = BF3.correct.percentage.0[BF3.correct.percentage.0$BF.3.cor == "correct" & BF3.correct.percentage.0$n_num < 2000, ], aes(color = "BF > 3")) +
  geom_line(data = BF3.correct.percentage.0[BF3.correct.percentage.0$BF.3.cor == "correct" & BF3.correct.percentage.0$n_num < 2000, ], aes(color = "BF > 3")) +
  geom_point(data = BF10.correct.percentage.0[BF10.correct.percentage.0$BF.10.cor == "correct" & BF10.correct.percentage.0$n_num < 2000, ], aes(color = "BF > 10")) +
  geom_line(data = BF10.correct.percentage.0[BF10.correct.percentage.0$BF.10.cor == "correct" & BF10.correct.percentage.0$n_num < 2000, ], aes(color = "BF > 10")) +
 scale_colour_manual("", 
                      breaks = c("p < .05", "HDI", "BF > 1", "BF > 3", "BF > 10", "BF > 30"),
                      values = c("black", "blue", "pink", "orange", "red", "purple")) +
  theme_apa() +
  scale_x_continuous(name = "Sample Size", breaks = c(10, 32, 64, 100, 300, 500, 2000)) +
  ylab("Percentage of Correct Samples") +
  ggtitle("Times Chosen for the Null when it is True")
```

## Visualize incorrect p and BF decisions for null

```{r}
BF3.incorrect.percentage.0 <- df0 %>%
  group_by(n_num, BF.3.ninc, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)
  
BF10.incorrect.percentage.0 <- df0 %>%
group_by(n_num, BF.10.ninc, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

BF30.incorrect.percentage.0 <- df0 %>%
  group_by(n_num, BF.30.ninc, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

ggplot(NULL, aes(x = n_num, y = pct)) + 
  ylim(0, 20) +
  geom_point(data = p.correct.percentage.0[p.correct.percentage.0$p.correct == "incorrect" & p.correct.percentage.0$n_num < 2000, ], aes(color = "p < .05")) + 
  geom_line(data = p.correct.percentage.0[p.correct.percentage.0$p.correct == "incorrect" & p.correct.percentage.0$n_num < 2000, ], aes(color = "p < .05")) + 
  geom_point(data = HDI.correct.percentage.0[HDI.correct.percentage.0$HDI.correct == "incorrect" & HDI.correct.percentage.0$n_num < 2000, ], aes(color = "HDI")) +
  geom_line(data = HDI.correct.percentage.0[HDI.correct.percentage.0$HDI.correct == "incorrect" & HDI.correct.percentage.0$n_num < 2000, ], aes(color = "HDI")) +
  geom_point(data = BF1.correct.percentage.0[BF1.correct.percentage.0$BF1.correct == "incorrect" & BF1.correct.percentage.0$n_num < 2000, ], aes(color = "BF > 1")) + 
  geom_line(data = BF1.correct.percentage.0[BF1.correct.percentage.0$BF1.correct == "incorrect" & BF1.correct.percentage.0$n_num < 2000, ], aes(color = "BF > 1")) + 
  geom_point(data = BF3.incorrect.percentage.0[BF3.incorrect.percentage.0$BF.3.ninc == "incorrect" & BF3.incorrect.percentage.0$n_num < 2000, ], aes(color = "BF > 3")) +
  geom_line(data = BF3.incorrect.percentage.0[BF3.incorrect.percentage.0$BF.3.ninc == "incorrect" & BF3.incorrect.percentage.0$n_num < 2000, ], aes(color = "BF > 3")) +
  geom_point(data = BF10.incorrect.percentage.0[BF10.incorrect.percentage.0$BF.10.ninc == "incorrect" & BF10.incorrect.percentage.0$n_num < 2000, ], aes(color = "BF > 10")) +
  geom_line(data = BF10.incorrect.percentage.0[BF10.incorrect.percentage.0$BF.10.ninc == "incorrect" & BF10.incorrect.percentage.0$n_num < 2000, ], aes(color = "BF > 10")) +
  scale_colour_manual("", 
                      breaks = c("p < .05", "HDI", "BF > 1", "BF > 3", "BF > 10", "BF > 30"),
                      values = c("black", "blue", "pink", "orange", "red", "purple")) +
  theme_apa() +
  scale_x_continuous(name = "Sample Size", breaks = c(10, 32, 64, 100, 300, 500, 2000)) +
  ylab("Percentage of Incorrect Samples") +
  ggtitle("Times Chosen for the Alternative when the Null is True")
```

## Visualize p correct and BF correct for alt

```{r}
p.correct.percentage <- df %>%
  group_by(n_num, p.correct, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

BF1.correct.percentage <- df %>%
  group_by(n_num, BF1.correct, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

HDI.correct.percentage <- df %>%
  group_by(n_num, HDI.correct, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

BF3.correct.percentage <- df %>%
  group_by(n_num, BF.3.cor, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

BF10.correct.percentage <- df %>%
group_by(n_num, BF.10.cor, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

BF30.correct.percentage <- df %>%
  group_by(n_num, BF.30.cor, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

ggplot(NULL, aes(x = n_num, y = pct)) + 
  ylim(0, 100) +
  geom_point(data = p.correct.percentage[p.correct.percentage$p.correct == "correct" & p.correct.percentage$n_num < 2000, ], aes(color = "p < .05")) + 
  geom_line(data = p.correct.percentage[p.correct.percentage$p.correct == "correct" & p.correct.percentage$n_num < 2000, ], aes(color = "p < .05")) + 
  geom_point(data = HDI.correct.percentage[HDI.correct.percentage$HDI.correct == "correct" & HDI.correct.percentage$n_num < 2000, ], aes(color = "HDI")) +
  geom_line(data = HDI.correct.percentage[HDI.correct.percentage$HDI.correct == "correct" & HDI.correct.percentage$n_num < 2000, ], aes(color = "HDI")) +
  geom_point(data = BF1.correct.percentage[BF1.correct.percentage$BF1.correct == "correct" & BF1.correct.percentage$n_num < 2000, ], aes(color = "BF > 1")) + 
  geom_line(data = BF1.correct.percentage[BF1.correct.percentage$BF1.correct == "correct" & BF1.correct.percentage$n_num < 2000, ], aes(color = "BF > 1")) +
  geom_point(data = BF3.correct.percentage[BF3.correct.percentage$BF.3.cor == "correct" & BF3.correct.percentage$n_num < 2000, ], aes(color = "BF > 3")) +
  geom_line(data = BF3.correct.percentage[BF3.correct.percentage$BF.3.cor == "correct" & BF3.correct.percentage$n_num < 2000, ], aes(color = "BF > 3")) +
  geom_point(data = BF10.correct.percentage[BF10.correct.percentage$BF.10.cor == "correct" & BF10.correct.percentage$n_num < 2000, ], aes(color = "BF > 10")) +
  geom_line(data = BF10.correct.percentage[BF10.correct.percentage$BF.10.cor == "correct" & BF10.correct.percentage$n_num < 2000, ], aes(color = "BF > 10")) +
  geom_point(data = BF30.correct.percentage[BF30.correct.percentage$BF.30.cor == "correct" & BF30.correct.percentage$n_num < 2000, ], aes(color = "BF > 30")) +
  geom_line(data = BF30.correct.percentage[BF30.correct.percentage$BF.30.cor == "correct" & BF30.correct.percentage$n_num < 2000, ], aes(color = "BF > 30")) +
  scale_colour_manual("", 
                      breaks = c("p < .05", "HDI", "BF > 1", "BF > 3", "BF > 10", "BF > 30"),
                      values = c("black", "blue", "pink", "orange", "red", "purple")) +
  theme_apa() +
  scale_x_continuous(name = "Sample Size", breaks = c(10, 32, 64, 100, 300, 500)) +
  ylab("Percentage of Correct Samples") +
  ggtitle("Times Chosen for the Alternative when it is True")
```

## Above without 10 and 30 as cutoffs

```{r}
ggplot(NULL, aes(x = n_num, y = pct)) + 
  ylim(0, 100) +
  geom_point(data = p.correct.percentage[p.correct.percentage$p.correct == "correct", ], aes(color = "p < .05")) + 
  geom_line(data = p.correct.percentage[p.correct.percentage$p.correct == "correct", ], aes(color = "p < .05")) + 
  geom_point(data = HDI.correct.percentage[HDI.correct.percentage$HDI.correct == "correct", ], aes(color = "HDI")) +
  geom_line(data = HDI.correct.percentage[HDI.correct.percentage$HDI.correct == "correct", ], aes(color = "HDI")) +
  geom_point(data = BF1.correct.percentage[BF1.correct.percentage$BF1.correct == "correct", ], aes(color = "BF > 1")) + 
  geom_line(data = BF1.correct.percentage[BF1.correct.percentage$BF1.correct == "correct", ], aes(color = "BF > 1")) +
  geom_point(data = BF3.correct.percentage[BF3.correct.percentage$BF.3.cor == "correct", ], aes(color = "BF > 3")) +
  geom_line(data = BF3.correct.percentage[BF3.correct.percentage$BF.3.cor == "correct", ], aes(color = "BF > 3")) +
  scale_colour_manual("", 
                      breaks = c("p < .05", "HDI", "BF > 1", "BF > 3"),
                      values = c("black", "blue", "pink", "orange")) +
  theme_apa() +
  scale_x_continuous(name = "Sample Size", breaks = c(10, 32, 64, 100, 300, 500)) +
  ylab("Percentage of Correct Samples") +
  ggtitle("Times Chosen for the Alternative when it is True")
```

## Visualize incorrect p and BF decisions for alt

```{r}
incorrect.rows.BF10.incor <- data.frame(c(10, 32, 64, 100, 300, 500),
        c("incorrect", "incorrect", "incorrect", "incorrect", "incorrect", "incorrect"),
        c(0, 0, 0, 0, 0, 0),
        c(0, 0, 0, 0, 0, 0),
        c(0, 0, 0, 0, 0, 0))

names(incorrect.rows.BF10.incor) <- c("n_num", "BF.10.ninc", "N", "freq", "pct")

incorrect.rows.BF30.incor <- data.frame(c(10, 32, 64, 100, 300, 500),
        c("incorrect", "incorrect", "incorrect", "incorrect", "incorrect", "incorrect"),
        c(0, 0, 0, 0, 0, 0),
        c(0, 0, 0, 0, 0, 0),
        c(0, 0, 0, 0, 0, 0))

names(incorrect.rows.BF30.incor) <- c("n_num", "BF.30.ninc", "N", "freq", "pct")

BF3.incorrect.percentage <- df %>%
  group_by(n_num, BF.3.ninc, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)

BF10.incorrect.percentage <- df %>%
group_by(n_num, BF.10.ninc, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100)  %>%
  as.data.frame() %>%
  plyr::rbind.fill(incorrect.rows.BF10.incor)

BF10.incorrect.percentage$BF.10.ninc <- as_factor(BF10.incorrect.percentage$BF.10.ninc)

BF30.incorrect.percentage <- df %>%
  group_by(n_num, BF.30.ninc, .drop = FALSE) %>%
  summarize(N = n()) %>%
  mutate(freq = N/sum(N),
         pct = freq*100) %>%
  as.data.frame() %>%
  plyr::rbind.fill(incorrect.rows.BF30.incor)

BF30.incorrect.percentage$BF.30.ninc <- as_factor(BF30.incorrect.percentage$BF.30.ninc)

ggplot(NULL, aes(x = n_num, y = pct)) + 
  ylim(0, 100) +
  geom_point(data = p.correct.percentage[p.correct.percentage$p.correct == "incorrect" & p.correct.percentage$n_num < 2000, ], aes(color = "p < .05")) + 
  geom_line(data = p.correct.percentage[p.correct.percentage$p.correct == "incorrect" & p.correct.percentage$n_num < 2000, ], aes(color = "p < .05")) + 
  geom_point(data = HDI.correct.percentage[HDI.correct.percentage$HDI.correct == "incorrect" & HDI.correct.percentage$n_num < 2000, ], aes(color = "HDI")) +
  geom_line(data = HDI.correct.percentage[HDI.correct.percentage$HDI.correct == "incorrect" & HDI.correct.percentage$n_num < 2000, ], aes(color = "HDI")) +
  geom_point(data = BF1.correct.percentage[BF1.correct.percentage$BF1.correct == "incorrect" & BF1.correct.percentage$n_num < 2000, ], aes(color = "BF > 1")) + 
  geom_line(data = BF1.correct.percentage[BF1.correct.percentage$BF1.correct == "incorrect" & BF1.correct.percentage$n_num < 2000, ], aes(color = "BF > 1")) + 
  geom_point(data = BF3.incorrect.percentage[BF3.incorrect.percentage$BF.3.ninc == "incorrect" & BF3.incorrect.percentage$n_num < 2000, ], aes(color = "BF > 3")) +
  geom_line(data = BF3.incorrect.percentage[BF3.incorrect.percentage$BF.3.ninc == "incorrect" & BF3.incorrect.percentage$n_num < 2000, ], aes(color = "BF > 3")) +
  geom_point(data = BF10.incorrect.percentage[BF10.incorrect.percentage$BF.10.ninc == "incorrect" & BF10.incorrect.percentage$n_num < 2000, ], aes(color = "BF > 10")) +
  geom_line(data = BF10.incorrect.percentage[BF10.incorrect.percentage$BF.10.ninc == "incorrect" & BF10.incorrect.percentage$n_num < 2000, ], aes(color = "BF > 10")) +
  geom_point(data = BF30.incorrect.percentage[BF30.incorrect.percentage$BF.30.ninc == "incorrect" & BF30.incorrect.percentage$n_num < 2000, ], aes(color = "BF > 30")) +
  geom_line(data = BF30.incorrect.percentage[BF30.incorrect.percentage$BF.30.ninc == "incorrect" & BF30.incorrect.percentage$n_num < 2000, ], aes(color = "BF > 30")) +
  scale_colour_manual("", 
                      breaks = c("p < .05", "HDI", "BF > 1", "BF > 3", "BF > 10", "BF > 30"),
                      values = c("black", "blue", "pink", "orange", "red", "purple")) +
  theme_apa() +
  scale_x_continuous(name = "Sample Size", breaks = c(10, 32, 64, 100, 300, 500)) +
  ylab("Percentage of Incorrect Samples") +
  ggtitle("Times Chosen for the Null when the Alternative is True")
```

## Examine precision of confidence interval and HDI

```{r}
width <- df %>%
  group_by(n) %>%
  select("ci.width", "hdi.width") %>%
  skim()
```

Create density plots for null

```{r}
width.plot0.10 <- data.frame(x = c(df0[df0$n == 10,]$ci.width, df0[df0$n == 10,]$hdi.width), 
                             type = rep(c("CI Width", "HDI Width"), 
                                      c(length(df0[df0$n == 10,]$ci.width), 
                                        length(df0[df0$n == 10,]$hdi.width)))) %>%
  ggplot() + 
  geom_density(aes(x=x, fill=type), alpha = 0.5) + 
  theme_apa() + 
  scale_fill_grey()

width.plot0.32 <- data.frame(x = c(df0[df0$n == 32,]$ci.width, df0[df0$n == 32,]$hdi.width), 
                             type = rep(c("CI Width", "HDI Width"), 
                                        c(length(df0[df0$n == 32,]$ci.width), 
                                          length(df0[df0$n == 32,]$hdi.width)))) %>%
  ggplot() + 
  geom_density(aes(x=x, fill=type), alpha = 0.5) + 
  theme_apa() + 
  scale_fill_grey()

width.plot0.64 <- data.frame(x = c(df0[df0$n == 64,]$ci.width, df0[df0$n == 64,]$hdi.width),
                             type = rep(c("CI Width", "HDI Width"),
                                        c(length(df0[df0$n == 64,]$ci.width), 
                                          length(df0[df0$n == 64,]$hdi.width)))) %>%
  ggplot() + 
  geom_density(aes(x=x, fill=type), alpha = 0.5) + 
  theme_apa() + 
  scale_fill_grey()

width.plot0.100 <- data.frame(x = c(df0[df0$n == 100,]$ci.width, df0[df0$n == 100,]$hdi.width), 
                              type=rep(c("CI Width", "HDI Width"), 
                                       c(length(df0[df0$n == 100,]$ci.width), 
                                         length(df0[df0$n == 100,]$hdi.width)))) %>%
  ggplot() + 
  geom_density(aes(x=x, fill=type), alpha = 0.5) + 
  theme_apa() + 
  scale_fill_grey()

width.plot0.300 <- data.frame(x = c(df0[df0$n == 300,]$ci.width, df0[df0$n == 300,]$hdi.width), 
                              type=rep(c("CI Width", "HDI Width"), 
                                       c(length(df0[df0$n == 300,]$ci.width), 
                                         length(df0[df0$n == 300,]$hdi.width)))) %>%
  ggplot() + 
  geom_density(aes(x=x, fill=type), alpha = 0.5) + 
  theme_apa() + 
  scale_fill_grey()

width.plot0.500 <- data.frame(x = c(df0[df0$n == 500,]$ci.width, df0[df0$n == 500,]$hdi.width), 
                              type=rep(c("CI Width", "HDI Width"), 
                                       c(length(df0[df0$n == 500,]$ci.width), 
                                         length(df0[df0$n == 500,]$hdi.width)))) %>%
  ggplot() + 
  geom_density(aes(x=x, fill=type), alpha = 0.5) + 
  theme_apa() + 
  scale_fill_grey()

width_plot0 <- width.plot0.10/
width.plot0.32/
width.plot0.64/
width.plot0.100/
width.plot0.300/
width.plot0.500

(width_plot0 <- width_plot0 & xlim(0, 30))
```
Create density plots for delta = 0.5

```{r}
width.plot.10 <- data.frame(x = c(df[df$n == 10,]$ci.width, df[df$n == 10,]$hdi.width), 
                            type=rep(c("CI Width", "HDI Width"), 
                                     c(length(df[df$n == 10,]$ci.width), 
                                       length(df[df$n == 10,]$hdi.width)))) %>%
  ggplot() + geom_density(aes(x=x, fill=type), alpha = 0.5) + theme_apa() + scale_fill_grey()

width.plot.32 <- data.frame(x = c(df[df$n == 32,]$ci.width, df[df$n == 32,]$hdi.width), 
                            type=rep(c("CI Width", "HDI Width"), 
                                     c(length(df[df$n == 32,]$ci.width), 
                                       length(df[df$n == 32,]$hdi.width)))) %>%
  ggplot() + geom_density(aes(x=x, fill=type), alpha = 0.5) + theme_apa() + scale_fill_grey()

width.plot.64 <- data.frame(x = c(df[df$n == 64,]$ci.width, df[df$n == 64,]$hdi.width), 
                            type=rep(c("CI Width", "HDI Width"), 
                                     c(length(df[df$n == 64,]$ci.width), 
                                       length(df[df$n == 64,]$hdi.width)))) %>%
  ggplot() + geom_density(aes(x=x, fill=type), alpha = 0.5) + theme_apa() + scale_fill_grey()

width.plot.100 <- data.frame(x = c(df[df$n == 100,]$ci.width, df[df$n == 100,]$hdi.width), 
                            type=rep(c("CI Width", "HDI Width"), 
                                     c(length(df[df$n == 100,]$ci.width), 
                                       length(df[df$n == 100,]$hdi.width)))) %>%
  ggplot() + geom_density(aes(x=x, fill=type), alpha = 0.5) + theme_apa() + scale_fill_grey()

width.plot.300 <- data.frame(x = c(df[df$n == 300,]$ci.width, df[df$n == 300,]$hdi.width), 
                            type=rep(c("CI Width", "HDI Width"), 
                                     c(length(df[df$n == 300,]$ci.width), 
                                       length(df[df$n == 300,]$hdi.width)))) %>%
  ggplot() + geom_density(aes(x=x, fill=type), alpha = 0.5) + theme_apa() + scale_fill_grey()

width.plot.500 <- data.frame(x = c(df[df$n == 500,]$ci.width, df[df$n == 500,]$hdi.width), 
                            type=rep(c("CI Width", "HDI Width"), 
                                     c(length(df[df$n == 500,]$ci.width), 
                                       length(df[df$n == 500,]$hdi.width)))) %>%
  ggplot() + geom_density(aes(x=x, fill=type), alpha = 0.5) + theme_apa() + scale_fill_grey()

width_plot <- width.plot.10/
width.plot.32/
width.plot.64/
width.plot.100/
width.plot.300/
width.plot.500

(width_plot <- width_plot & xlim(0, 30))
```


## Show corresponding conclusions for null

```{r}
# Set alpha and size -----------------------------------------------------------
a <- 0.1
s <- 0.1

# For p values and Bayes factor cutoffs-----------------------------------------
(bf3.p.plot.0 <- ggplot(df0, aes(x = BF3.decision, y = p.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
(bf10.p.plot.0 <- ggplot(df0, aes(x = BF10.decision, y = p.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
(bf30.p.plot.0 <- ggplot(df0, aes(x = BF30.decision, y = p.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))

(bf.p.plot.0 <- 
  bf3.p.plot.0/
  bf10.p.plot.0/
  bf30.p.plot.0)

# For HDI and BF cutoffs --------------------------------------------------------

(bf3.hdi.plot.0 <- ggplot(df0, aes(x = BF3.decision, y = HDI.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
(bf10.hdi.plot.0 <- ggplot(df0, aes(x = BF10.decision, y = HDI.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
(bf30.hdi.plot.0 <- ggplot(df0, aes(x = BF30.decision, y = HDI.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))

(bf.hdi.plot.0 <- 
  bf3.hdi.plot.0/
  bf10.hdi.plot.0/
  bf30.hdi.plot.0)

# For p values and HDI ---------------------------------------------------------
(hdi.p.plot.0 <- ggplot(df0, aes(x = HDI.decision, y = p.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))

# For CI and HDI estimation ----------------------------------------------------
(hdi.ci.plot.0 <- ggplot(df0, aes(x = HDI.est.correct, y = CI.est.correct)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
```

## Show corresponding conclusions for d = 0.5

```{r}
# Set alpha and size -----------------------------------------------------------
a <- 0.1
s <- 0.1

# For p values and Bayes factor cutoffs-----------------------------------------
(bf3.p.plot <- ggplot(df, aes(x = BF3.decision, y = p.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
(bf10.p.plot <- ggplot(df, aes(x = BF10.decision, y = p.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
(bf30.p.plot <- ggplot(df, aes(x = BF30.decision, y = p.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))

(bf.p.plot <- 
  bf3.p.plot/
  bf10.p.plot/
  bf30.p.plot)

# For HDI and BF cutoffs --------------------------------------------------------

(bf3.hdi.plot <- ggplot(df, aes(x = BF3.decision, y = HDI.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
(bf10.hdi.plot <- ggplot(df, aes(x = BF10.decision, y = HDI.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
(bf30.hdi.plot <- ggplot(df, aes(x = BF30.decision, y = HDI.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))

(bf.hdi.plot <- 
  bf3.hdi.plot/
  bf10.hdi.plot/
  bf30.hdi.plot)

# For p values and HDI ---------------------------------------------------------
(hdi.p.plot <- ggplot(df, aes(x = HDI.decision, y = p.decision)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))

# For CI and HDI estimation ----------------------------------------------------
(hdi.ci.plot <- ggplot(df, aes(x = HDI.est.correct, y = CI.est.correct)) + geom_jitter(alpha = a, size = s) + theme_apa() + scale_fill_grey() + facet_grid(cols = vars(n)))
```

## Bar plots for corresponding conclusions at null

```{r}
ggplot(data = df0,
       aes(x = BF1.decision, fill = HDI.decision)) +
  geom_bar(aes(y = (..count..)/sum(..count..))) +
  ylab(label = "Percentage") +
  xlab(label = "Decision for Decision Rule BF > 1") +
  theme_apa()

```

## Bar plots for corresponding conclusions for alternative

```{r}
ggplot(data = df,
       aes(x = BF1.decision, fill = HDI.decision)) +
  geom_bar(aes(y = (..count..)/sum(..count..))) +
  ylab(label = "Percentage") +
  xlab(label = "Decision for Decision Rule BF > 1") +
  theme_apa()
```

# Compare estimation

Load a function that computed if intervals (CI and HDI) contain the mean of a next replication. For the last set in the data, the mean difference of the first row is used.

```{r}
source("interval_inclusion.R")
```

## Run computations

```{r}
# Null
inc.null.10 <- interval_inclusion(df0[df0$n == 10,])

inc.null.32 <- interval_inclusion(df0[df0$n == 32,])

inc.null.64 <- interval_inclusion(df0[df0$n == 64,])

inc.null.100 <- interval_inclusion(df0[df0$n == 100,])

inc.null.300 <- interval_inclusion(df0[df0$n == 300,])

inc.null.500 <- interval_inclusion(df0[df0$n == 500,])


# Alt
inc.alt.10 <- interval_inclusion(df[df$n == 10,])

inc.alt.32 <- interval_inclusion(df[df$n == 32,])

inc.alt.64 <- interval_inclusion(df[df$n == 64,])

inc.alt.100 <- interval_inclusion(df[df$n == 100,])

inc.alt.300 <- interval_inclusion(df[df$n == 300,])

inc.alt.500 <- interval_inclusion(df[df$n == 500,])
```


